<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guides/unmanic_kubernetes_install">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Install Unmanic - Kubernetes | Unmanic</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://docs.unmanic.app/docs/guides/unmanic_kubernetes_install"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Install Unmanic - Kubernetes | Unmanic"><meta data-rh="true" name="description" content="Unmanic Kubernetes Install Guide"><meta data-rh="true" property="og:description" content="Unmanic Kubernetes Install Guide"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://docs.unmanic.app/docs/guides/unmanic_kubernetes_install"><link data-rh="true" rel="alternate" href="http://docs.unmanic.app/docs/guides/unmanic_kubernetes_install" hreflang="en"><link data-rh="true" rel="alternate" href="http://docs.unmanic.app/docs/guides/unmanic_kubernetes_install" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6898c410.css">
<link rel="preload" href="/assets/js/runtime~main.b1268ea0.js" as="script">
<link rel="preload" href="/assets/js/main.7497d8a4.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon.png" alt="Unmanic Icon" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/icon.png" alt="Unmanic Icon" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Unmanic - Library Optimiser</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/stats/">Stats</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Unmanic" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/">Welcome</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/requirements">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/dashboard/pending_tasks">Using Unmanic</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/development/developing_plugins">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/advanced/hardware_accelerated_encoding_vaapi">Advanced</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/guides/unmanic_windows_install">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/unmanic_windows_install">Install Unmanic - Windows 10 (WSL + Docker)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/unmanic_macos_install">Install Unmanic - MacOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/unmanic_kubernetes_install">Install Unmanic - Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/unmanic_link_installations">Linking Unmanic Installations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/nvidia_support_unmanic_on_linux">NVIDIA Hardware Acceleration on Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/filebot_post_processor">Running a FileBot Post-processor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/script_subtitle_stripping">Subtitle Stripping</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Install Unmanic - Kubernetes</h1></header><p><img loading="lazy" src="https://img.shields.io/badge/Difficulty-moderate-orange?style=flat" alt="Difficulty" class="img_ev3q">
<img loading="lazy" src="https://img.shields.io/badge/Setup%20Time-30%20minutes-orange?style=flat" alt="Setup Time" class="img_ev3q">
<a href="https://github.com/preimmortal" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://img.shields.io/badge/Original%20Author-preimmortal-lightgrey?style=flat?style=plastic&amp;logo=github" alt="Original Author" class="img_ev3q"></a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">​</a></h2><p>This requires a functional Kubernetes Cluster or similar (k3s, minikube, etc).</p><p>For Kubernetes installation instructions</p><ul><li><a href="https://kubernetes.io/docs/setup/" target="_blank" rel="noopener noreferrer">Kubernetes Getting Started Guide</a></li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>K3S 1.22.7 was used to create this guide.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-unmanic">Running Unmanic<a class="hash-link" href="#running-unmanic" title="Direct link to heading">​</a></h2><p>There are two parts to running Unmanic in Kubernetes.</p><ol><li>Deployment - The unmanic container configuration</li><li>Service - The service that exposes the unmanic container to outside the Kubernetes cluster</li></ol><p>For a basic deployment and service, create a file <code>unmanic.yaml</code> and append the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: unmanic-deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      app: unmanic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  strategy:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type: Recreate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        app: unmanic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: unmanic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          image: josh5/unmanic:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - containerPort: 8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              name: unmanic-port</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              protocol: TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          env:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - name: PUID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              value: &quot;&lt;PUID&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - name: PGID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              value: &quot;&lt;PGID&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          volumeMounts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - mountPath: /library</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              name: library</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - mountPath: /config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              name: unmanic-config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - mountPath: /tmp/unmanic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              name: unmanic-cache</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: library</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          nfs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            server: &lt;NFS_SERVER_ADDRESS&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            path: &lt;/PATH/TO/NFS/SHARE&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: unmanic-config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          emptyDir: {} # Please use a more permanent storage, see Tuning section</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: unmanic-cache</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          emptyDir: {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: unmanic-service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    app: unmanic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  type: NodePort</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - name: unmanic-port</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      port: 8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      targetPort: 8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      nodePort: 30000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To start the deployment and service, run the following command: <code>kubectl create -f unmanic.yaml</code></p><p>To delete the deployment and service, run the following command: <code>kubectl delete -f unmanic.yaml</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-unmanic-rootless">Running Unmanic Rootless<a class="hash-link" href="#running-unmanic-rootless" title="Direct link to heading">​</a></h2><p>In kubernetes you can run containers as non root, doing so will allow you to harden the system for outside/inside threats.
Use securityContext to set the user to be used by the app, make sure your library storage is also set to the same uid/gid as you specify here.</p><p>To not run the s6-overlay(which needs root) add <code>command: [&quot;/usr/local/bin/unmanic-service&quot;]</code>.</p><p>Specify as a env the home location which is supposed to be set to the config volume location.</p><p>Use only as reference</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: unmanic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    app: unmanic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      app: unmanic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        app: unmanic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      securityContext:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        runAsUser: 568 # in this case i will be using user 568, change how you like</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        runAsGroup: 568</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fsGroup: 568</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - name: unmanic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        image: josh5/unmanic:latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        command: [&quot;/usr/local/bin/unmanic-service&quot;] # Hard requirement for running rootless</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - containerPort: 8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          protocol: TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          name: http</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: HOME # Hard requirement for running rootless</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          value: &quot;/config&quot; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        volumeMounts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: unmanic-config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          mountPath: /config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: media</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          mountPath: /media</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: unmanic-config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            claimName: unmanic-rbd # In this example I am using a persistentvolume claim, change as you see fit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - name: media</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          nfs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            server: IP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            path: /path/to/export/folder</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Its possible that not all plugins will work.
Tested with: Transcode Video Files and File Size Metrics Data Panel</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tuning-kubernetes-unmanic-configuration">Tuning Kubernetes Unmanic Configuration<a class="hash-link" href="#tuning-kubernetes-unmanic-configuration" title="Direct link to heading">​</a></h2><p>Note that the following values should be tuned based on need:</p><ul><li>Using NFS to share the library path to Kubernetes, please update as necessary if using CIFS or another file sharing service</li><li>Using emptyDir for the config and cache path, please update emptyDir to more permanent paths</li><li>Using NodePort to expose the Unmanic service, please update when using a load balancer or other method to expose the unmanic deployment</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>It is important not to use <code>emptyDir</code> for the <code>unmanic-config</code> in a permanent installation because the config will be deleted upon stopping the deployment.
Please consider using a more permanent volume such as iSCSI or backing up to NFS.</p><ul><li><a href="https://kubernetes.io/docs/concepts/storage/volumes/" target="_blank" rel="noopener noreferrer">Kubernetes Volumes</a></li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-unmanic-via-nodeport">Accessing Unmanic via NodePort<a class="hash-link" href="#accessing-unmanic-via-nodeport" title="Direct link to heading">​</a></h2><p>Unmanic will be available via the web browser at following address: <code>&lt;Kubernetes_Cluster_Address&gt;:30000</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="linux-hardware-acceleration-va-api">Linux Hardware Acceleration (VA-API)<a class="hash-link" href="#linux-hardware-acceleration-va-api" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="intel-integrated-gpu">Intel Integrated GPU<a class="hash-link" href="#intel-integrated-gpu" title="Direct link to heading">​</a></h3><p>It is possible to expose underlying Intel integrated GPU hardware that supports QSV/VA-API hardware acceleration into a Kubernetes workload. The proper method for implementing this functionality is through two additional Kubernetes add-ons:</p><ul><li><a href="https://kubernetes-sigs.github.io/node-feature-discovery/" target="_blank" rel="noopener noreferrer">Node feature discovery</a> to automatically detect and label worker nodes with specialized hardware.</li><li><a href="https://github.com/intel/intel-device-plugins-for-kubernetes" target="_blank" rel="noopener noreferrer">Intel GPU Plugin</a> to automatically expose GPU hardware to workloads, e.g. <code>/dev/dri/renderD128</code>.</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This guide does not walk through the full installation and configuration for the aforementioned Kubernetes add-ons. This process is relatively straightforward using the most up-to-date guides from the associated links to upstream repositories.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequistes">Prerequistes<a class="hash-link" href="#prerequistes" title="Direct link to heading">​</a></h3><ol><li>Validate hardware compatibility</li><li>Install Intel GPU drivers</li><li>Install and configure <a href="https://github.com/intel/intel-device-plugins-for-kubernetes" target="_blank" rel="noopener noreferrer">intel-gpu-plugin</a> add-on</li><li>Install and configure <a href="https://github.com/kubernetes-sigs/node-feature-discovery" target="_blank" rel="noopener noreferrer">node-feature-discovery</a> add-on</li><li>Kubernetes manifest considerations</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="validate-hardware-compatibility">Validate Hardware Compatibility<a class="hash-link" href="#validate-hardware-compatibility" title="Direct link to heading">​</a></h3><p>The Kubernetes worker node exposing GPU functionality to workloads requires Intel GPU drivers to be installed at the host level. An official lookup table exists for <a href="https://dgpu-docs.intel.com/devices/hardware-table.html" target="_blank" rel="noopener noreferrer">GPU hardware values</a> to confirm they are supported. In the following example, <code>[8086:9a49]</code> indicates the vendor <code>8086</code> (Intel) and <code>9a49</code> (GPU; Iris Xe) from the lookup table.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ lspci -nn |grep  -Ei &#x27;VGA|DISPLAY&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">00:02.0 VGA compatible controller [0300]: Intel Corporation TigerLake-LP GT2 [Iris Xe Graphics] [8086:9a49] (rev 01)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-intel-gpu-drivers">Install Intel GPU drivers<a class="hash-link" href="#install-intel-gpu-drivers" title="Direct link to heading">​</a></h3><p>The official Intel documentation outlines instructions for installation of the appropriate <a href="https://dgpu-docs.intel.com/installation-guides/ubuntu/ubuntu-jammy-legacy.html" target="_blank" rel="noopener noreferrer">Intel drivers on Ubuntu 22.04 (jammy)</a>. Once the drivers have been installed, a reboot is required before validation steps below:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Install hwinfo and vainfo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ apt update &amp;&amp; apt install -y hwinfo vainfo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Confirm Intel GPU drivers are functional</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ hwinfo --display</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">25: PCI 02.0: 0300 VGA compatible controller (VGA)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [Created at pci.386]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Unique ID: _Znp.vvQ429ch_ZF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SysFS ID: /devices/pci0000:00/0000:00:02.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SysFS BusID: 0000:00:02.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Hardware Class: graphics card</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Device Name: &quot;Onboard - Video&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Model: &quot;Intel UHD Graphics&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Vendor: pci 0x8086 &quot;Intel Corporation&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Device: pci 0x9a49 &quot;UHD Graphics&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SubVendor: pci 0x8086 &quot;Intel Corporation&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  SubDevice: pci 0x3002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Revision: 0x01</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Driver: &quot;i915&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Driver Modules: &quot;i915&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Memory Range: 0x603c000000-0x603cffffff (rw,non-prefetchable)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Memory Range: 0x4000000000-0x400fffffff (ro,non-prefetchable)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  I/O Ports: 0x3000-0x303f (rw)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Memory Range: 0x000c0000-0x000dffff (rw,non-prefetchable,disabled)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  IRQ: 177 (15621845 events)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Module Alias: &quot;pci:v00008086d00009A49sv00008086sd00003002bc03sc00i00&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Driver Info #0:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Driver Status: i915 is active</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Driver Activation Cmd: &quot;modprobe i915&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Config Status: cfg=new, avail=yes, need=no, active=unknown</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Primary display adapter: #25</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Verify profiles supported by hardware</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ vainfo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">libva info: VA-API version 1.16.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">libva info: Trying to open /usr/lib/x86_64-linux-gnu/dri/iHD_drv_video.so</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">libva info: Found init function __vaDriverInit_1_16</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">libva info: va_openDriver() returns 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vainfo: VA-API version: 1.16 (libva 2.12.0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vainfo: Driver version: Intel iHD driver for Intel(R) Gen Graphics - 22.6.4 (aca8ee0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vainfo: Supported profile and entrypoints</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">... truncated list of profiles ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-and-configure-intel-gpu-plugin">Install and Configure Intel GPU Plugin<a class="hash-link" href="#install-and-configure-intel-gpu-plugin" title="Direct link to heading">​</a></h3><p>The <a href="https://github.com/intel/intel-device-plugins-for-kubernetes" target="_blank" rel="noopener noreferrer">intel-gpu-plugin</a> add-on will provide the ability to expose <code>i915</code> devices to pods within the cluster. Due to the continually changing nature of Kubernetes, it&#x27;s recommended to use the official documentation for installation of this add-on. This process will effectively passthrough the <code>/dev/dri/*</code> devices to workloads that are requesting it.</p><p>By default, passthrough will consume the associated device for that workload. It is possible to share a device with multiple workloads at the same time. Runtime argument <code>-shared-dev-num 2</code> allows two workloads access to the GPU simultaneously. Additional information or runtime options can be found <a href="https://intel.github.io/intel-device-plugins-for-kubernetes/cmd/gpu_plugin/README.html#modes-and-configuration-options" target="_blank" rel="noopener noreferrer">here</a>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>It&#x27;s important to note that exposing the GPU device is only one part of the equation. You also need to ensure any pods consuming the resources have adequate permissions to access the device. This can be achieved with addition of <code>supplementalGroups: [44, 109]</code> in the associated workload manifest. This is documented in the Supplemental Device Permissions section.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-and-configure-node-feature-discovery-nfd">Install and Configure Node Feature Discovery (NFD)<a class="hash-link" href="#install-and-configure-node-feature-discovery-nfd" title="Direct link to heading">​</a></h3><p>The <a href="https://github.com/kubernetes-sigs/node-feature-discovery" target="_blank" rel="noopener noreferrer">node-feature-discovery</a> add-on is used to automatically label worker nodes with specialized hardware. Due to the continually changing nature of Kubernetes, it&#x27;s recommended to use the official documentation for installation. Once deployed within a Kubernetes cluster, nodes containing Intel GPU hardware will be labeled with <code>feature.node.kubernetes.io/custom-intel-gpu=true</code>. You can use this label to apply affinity rules that will only schedule workloads on nodes with appropriate hardware.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="manifest-configuration-considerations">Manifest Configuration Considerations<a class="hash-link" href="#manifest-configuration-considerations" title="Direct link to heading">​</a></h3><p>Additional configuration within Kubernetes is required to take advantage of the underlying hardware. The following sections will provide additional detail depending on your needs.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="resource-management">Resource Management<a class="hash-link" href="#resource-management" title="Direct link to heading">​</a></h4><p>Providing resource management constraints will help to ensure a workload has adequate resources. Kubernetes will schedule workloads where the resources are available, allowing them to consume more than the <code>requests</code> values, but not beyond the <code>limit</code> value. In the following example, the workload is allowed access to the GPU device exposed through the Intel GPU plugin. Additionally, a maximum of 4 CPU cores and 8GB of memory can be consumed by the workload. The following YAML should be applied in the <code>deployment.spec.template.spec</code> section from the deployment manifest example.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        requests:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          cpu: 100m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          memory: 256M</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          gpu.intel.com/i915: 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        limits:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          cpu: 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          memory: 8G</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          gpu.intel.com/i915: 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="supplemental-device-permissions">Supplemental Device Permissions<a class="hash-link" href="#supplemental-device-permissions" title="Direct link to heading">​</a></h4><p>Devices exposed by Intel GPU drivers in <code>/dev/dri/*</code> have special group permissions for <code>video</code> and <code>render</code> operating system groups.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ls -la /dev/dri</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">total 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x  3 root root        100 Jan 21 23:15 .</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x 20 root root       4840 Jan 23 09:15 ..</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x  2 root root         80 Jan 21 23:15 by-path</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">crw-rw----  1 root video  226,   0 Jan 21 23:15 card0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">crw-rw----  1 root render 226, 128 Jan 21 23:15 renderD128</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ egrep &quot;video|render&quot; /etc/group</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">video:x:44:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">render:x:109:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In order to utilize the devices in a workload, you must ensure supplemental group permissions are applied. This can be achieved by adding a <code>securityContext</code> to the above deployment manifest. The following YAML should be applied in the <code>deployment.spec.template.spec</code> section from the deployment manifest example.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">      securityContext:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        supplementalGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          - 44</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          - 109</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="affinity-rules">Affinity Rules<a class="hash-link" href="#affinity-rules" title="Direct link to heading">​</a></h4><p>Affinity rules allow or disallow workloads from being placed where they shouldn&#x27;t. For example, if only two worker nodes have compatible Intel GPU hardware, using the NFD node label <code>feature.node.kubernetes.io/custom-intel-gpu</code> will ensure workloads requiring GPU access to be scheduled on the corresponding nodes. The following YAML should be applied in the <code>deployment.spec.template.spec</code> section from the deployment manifest example.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">      affinity:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        nodeAffinity:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            nodeSelectorTerms:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              - matchExpressions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  - key: feature.node.kubernetes.io/custom-intel-gpu</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    operator: In</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    values:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                      - &quot;true&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/guides/unmanic_macos_install"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Install Unmanic - MacOS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/unmanic_link_installations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Linking Unmanic Installations</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#running-unmanic" class="table-of-contents__link toc-highlight">Running Unmanic</a></li><li><a href="#running-unmanic-rootless" class="table-of-contents__link toc-highlight">Running Unmanic Rootless</a></li><li><a href="#tuning-kubernetes-unmanic-configuration" class="table-of-contents__link toc-highlight">Tuning Kubernetes Unmanic Configuration</a></li><li><a href="#accessing-unmanic-via-nodeport" class="table-of-contents__link toc-highlight">Accessing Unmanic via NodePort</a></li><li><a href="#linux-hardware-acceleration-va-api" class="table-of-contents__link toc-highlight">Linux Hardware Acceleration (VA-API)</a><ul><li><a href="#intel-integrated-gpu" class="table-of-contents__link toc-highlight">Intel Integrated GPU</a></li><li><a href="#prerequistes" class="table-of-contents__link toc-highlight">Prerequistes</a></li><li><a href="#validate-hardware-compatibility" class="table-of-contents__link toc-highlight">Validate Hardware Compatibility</a></li><li><a href="#install-intel-gpu-drivers" class="table-of-contents__link toc-highlight">Install Intel GPU drivers</a></li><li><a href="#install-and-configure-intel-gpu-plugin" class="table-of-contents__link toc-highlight">Install and Configure Intel GPU Plugin</a></li><li><a href="#install-and-configure-node-feature-discovery-nfd" class="table-of-contents__link toc-highlight">Install and Configure Node Feature Discovery (NFD)</a></li><li><a href="#manifest-configuration-considerations" class="table-of-contents__link toc-highlight">Manifest Configuration Considerations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://unmanic.app/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/jsunnex" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Unmanic" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Josh Sunnex. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b1268ea0.js"></script>
<script src="/assets/js/main.7497d8a4.js"></script>
</body>
</html>